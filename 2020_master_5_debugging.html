<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>reveal-md</title>
    <link rel="stylesheet" href="./css/reveal.css" />
    <link rel="stylesheet" href="./css/theme/black.css" id="theme" />
    <link rel="stylesheet" href="./css/highlight/zenburn.css" />
    <link rel="stylesheet" href="./css/print/paper.css" type="text/css" media="print" />
    <link rel="stylesheet" href="./_assets/assets/styles.css" />

  </head>
  <body>
    <div class="reveal">
      <div class="slides"><section ><section data-markdown><script type="text/template"># Debugging JS
</script></section><section data-markdown><script type="text/template">
# console.log debugging

- Add console.log statements
- Click through the app
- See the log statements in chrome dev tools
  - easy to get started
  - some problems might be tough to track down
</script></section><section data-markdown><script type="text/template">
# Using Breakpoints

- Chrome/Firefox devtools allow breakpoints
- Breakpoints are a way to pause a programm
  - variables can be inspected
  - custom code can be executed via js console
</script></section><section data-markdown><script type="text/template">
# How to add breakpoints

- Via EventListeners
  - DevTools > Sources > EventListener Breakpoints
- Via DOM events
  - eg. element is removed/added to dom
- In DevTools
  - Sources > find line of code > click on line number
- Via Code
  - add debugger statement
</script></section><section data-markdown><script type="text/template">
# Via Debugger Statement

```js
export default isForm(({ form }) => {
  const { t } = useTranslation()
  return (
    <Form
      {...form}
      onSubmit={(evt) => {
        debugger // <= this opens a new debugger session
        form.onSubmit(evt)
      }}
    >
      <TextInput name='email' label={t('email')} {...form} />
      <PasswordInput name='password' label={t('password')} {...form} />
      {/* ... */}
    </Form>
  )
})
```
</script></section><section data-markdown><script type="text/template">
# DOM event breakpoints

![DOM breakpoints](assets/chrome_dom_breakpoints.png)
</script></section><section data-markdown><script type="text/template">
# Breakpoint navigation

![Chrome dev tools](assets/chrome_dev_tools.png)
</script></section><section data-markdown><script type="text/template">
# Debugging NodeJS

- VS Code Setup
  - <https://dev.to/john_papa/debug-your-nodejs-app-in-60-seconds-5cni>
- Webstorm Setup
  - <https://www.jetbrains.com/help/webstorm/run-debug-configuration-node-js-remote-debug.html>
- Staring tests
  - JEST `node --inspect-brk node_modules/.bin/jest --runInBand --watch`
  - mocha `npm run test -- --inspect-brk --watch`
</script></section><section data-markdown><script type="text/template">
# Task

- Try to setup debugger for backend
- Start the backend and set breakpoint
  - make sure to start node with `--inspect-brk`
- Maybe you have a bug which you want to investigate
- Timebox: 15min
</script></section></section><section ><section data-markdown><script type="text/template">
# Debugging performance issues
</script></section><section data-markdown><script type="text/template">
## Chrome performance tab

- Determine why CPU is busy
- Flame graph Visualisation of
  - call stack
  - duration of fn call

![Flamegraph](assets/flamegraph.png)
</script></section><section data-markdown><script type="text/template">
# Bottom up

- Which functions had the most impact on performance

![Flamegraph](assets/bottom_up.png)
</script></section><section data-markdown><script type="text/template">
# Measure CPU Performance

- Open dev tools
- Go to Performance > Record
  - Click stop
</script></section><section data-markdown><script type="text/template">
# Simulating slow devices/network

![Slow device/network](assets/chrome_cpu_throttle.png)
</script></section></section><section  data-markdown><script type="text/template">
### Web Performance API

- Set of tools which expos information about
  - Performance of a Web Page
  - Network
  - Internal Browser operations
</script></section><section  data-markdown><script type="text/template">
### window.performance.timing

- Performance information about current webpage
  - DNS/TCP timing
  - Request/Response timing
  - document ready timing
  - ...

![Performance timing](assets/performance_timing.png)
</script></section><section ><section data-markdown><script type="text/template">
### Measure time in JS code

```js
const t0 = performance.now()
doSomething()
const t1 = performance.now()
console.log(`Call to doSomething took ${t1 - t0} milliseconds.`)
```
</script></section><section data-markdown><script type="text/template">
### Why not use Date.now()

- Date.now() is based on system time
  - synchronized from time to time
    - might lead to wrong measurements
  - days with leap seconds
    - depending on implementation
      - 1 second !== 1 system second
  - max resolution: milliseconds
</script></section><section data-markdown><script type="text/template">
### performance.now()

- monotonic time between time origin/current time
  - uniformly increasing
  - time origin when document initiated
- max resolution: floating point milliseconds
</script></section></section><section ><section data-markdown><script type="text/template">
### Performance Entry List

- Global Buffer:
  - stores performance relevant information

```ts
interface PerformanceObserverEntryList {
  PerformanceEntryList getEntries();
  PerformanceEntryList getEntriesByType (DOMString type);
  PerformanceEntryList getEntriesByName (DOMString name, optional DOMString type);
};
```

```js
window.performance.getEntries()
```
</script></section><section data-markdown><script type="text/template">
### PerformanceEntry

```ts
interface PerformanceEntry {
  readonly    attribute DOMString           name;
  readonly    attribute DOMString           entryType;
  readonly    attribute DOMHighResTimeStamp startTime;
  readonly    attribute DOMHighResTimeStamp duration;
  [Default] object toJSON();
  // + additional properties depending on entryType
};
```
</script></section></section><section  data-markdown><script type="text/template">
### performance.mark()

- adds a PerformanceEntry to global buffer
- used to measure timings in distant parts of the app

```js
const START_MARK = 'before Math.random()'
const END_MARK = 'after Math.random()'

performance.mark(START_MARK)
Math.random()
// ... some other application logic
performance.mark(END_MARK)

performance.measure('measure a to b', START_MARK, END_MARK)
window.performance.getEntries().slice(-3) // returns the marks + the measure entry
```
</script></section><section  data-markdown><script type="text/template">
### Task

- Go to your master project
- Open profiler
  - find the slowest function
</script></section><section  data-markdown><script type="text/template">
# Feedback

- Questions: tmayrhofer.lba@fh-salzburg.ac.at
- <https://de.surveymonkey.com/r/XQ96YZX>
</script></section></div>
    </div>

    <script src="./lib/js/head.min.js"></script>
    <script src="./js/reveal.js"></script>

    <script>
      function extend() {
        var target = {};
        for (var i = 0; i < arguments.length; i++) {
          var source = arguments[i];
          for (var key in source) {
            if (source.hasOwnProperty(key)) {
              target[key] = source[key];
            }
          }
        }
        return target;
      }

      // Optional libraries used to extend on reveal.js
      var deps = [
        { src: './lib/js/classList.js', condition: function() { return !document.body.classList; } },
        { src: './plugin/markdown/marked.js', condition: function() { return !!document.querySelector('[data-markdown]'); } },
        { src: './plugin/markdown/markdown.js', condition: function() { return !!document.querySelector('[data-markdown]'); } },
        { src: './plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
        { src: './plugin/zoom-js/zoom.js', async: true },
        { src: './plugin/notes/notes.js', async: true },
        { src: './plugin/math/math.js', async: true }
      ];

      // default options to init reveal.js
      var defaultOptions = {
        controls: true,
        progress: true,
        history: true,
        center: true,
        transition: 'default', // none/fade/slide/convex/concave/zoom
        dependencies: deps
      };

      // options from URL query string
      var queryOptions = Reveal.getQueryHash() || {};

      var options = extend(defaultOptions, {}, queryOptions);
    </script>


    <script>
      Reveal.initialize(options);
    </script>
  </body>
</html>
